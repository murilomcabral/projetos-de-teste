<!DOCTYPE html>
<html lang="pt-br">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <style>

      *, ::before, ::after {margin: 0;padding: 0;box-sizing: border-box;}

      html {
         background-color: bisque;
      }

      svg {
         background-color: rgba(255 255 255 / .5);
      }
      
      path {
         stroke: red;
         fill: rgba(0 0 255 / .2);
         stroke-width: 1px;
      }

   </style>
   <title></title>
</head>
<body>
   <svg>
      <path d="M50 50C120 120 100 150 150 150"></path>
      <path d="M50 50L120 120"></path>
      <path d="M150 150L100 150"></path>
   </svg>
   <script>

      const table = document.querySelector('table')
      const svgCanvas = document.querySelector('svg')
      const pathObject = document.querySelector('path')
      let svgPos = svgCanvas.getBoundingClientRect()
      let dCheck = ''
      const textarea = document.querySelector('textarea')
      
      
      //track line end
      function handleMouseEvent(e) {
         //adjust click X and Y >>>>>
         svgPos = svgCanvas.getBoundingClientRect()
         console.log(`${Math.floor(svgPos.x)} | ${Math.floor(svgPos.y)}`)
         let xPos = e.clientX - Math.floor(svgPos.x)
         let yPos = e.clientY - Math.floor(svgPos.y)
         //<<<<<
         pathObject.setAttribute('d', `${dCheck}L${xPos} ${yPos}`)
      }

      //double-click closes path
      function closePath() {
         d = pathObject.getAttribute('d')
         d += 'z'
         pathObject.setAttribute('d', d)
         svgCanvas.removeEventListener('mousemove', handleMouseEvent)
         textarea.innerText = pathObject.getAttribute('d')
      }

      svgCanvas.addEventListener('dblclick', closePath)
      window.addEventListener('keydown', (e) => {if (e.key === 'Enter') {closePath()}})

      //start drawing
      svgCanvas.addEventListener('click', (e) => {
         //adjust click X and Y >>>>>
         svgPos = svgCanvas.getBoundingClientRect()
         console.log(`${Math.floor(svgPos.x)} | ${Math.floor(svgPos.y)}`)
         let xPos = e.clientX - Math.floor(svgPos.x)
         let yPos = e.clientY - Math.floor(svgPos.y)
         //<<<<<

         if (!pathObject.hasAttribute('d')) {
            pathObject.setAttribute('d', `M${xPos} ${yPos}`)
         } else {
            let d2 = pathObject.getAttribute('d')
            if (d2.charAt(d2.length - 1) == 'z') {
               pathObject.setAttribute('d', `${d2}M${xPos} ${yPos}`)
            }
         }

         dCheck = pathObject.getAttribute('d')
         svgCanvas.addEventListener('mousemove', handleMouseEvent)

      })

      const ps = document.querySelector('path')
      const psL = ps.getTotalLength()

   </script>
</body>
</html>